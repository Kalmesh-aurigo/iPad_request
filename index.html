<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IT Support Kiosk</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d0f14;
      --surface: #13161d;
      --surface-2: #1a1e28;
      --border: rgba(255,255,255,0.07);
      --border-active: rgba(0, 210, 140, 0.5);
      --accent: #00d28c;
      --accent-dim: rgba(0, 210, 140, 0.12);
      --text: #e8eaf0;
      --text-muted: #5a6070;
      --text-mid: #8b92a5;
      --error: #ff5a5a;
      --warn: #ffb347;
      --grid-line: rgba(0,210,140,0.03);
      --glow: rgba(0,210,140,0.12);
    }

    :root.light {
      --bg: #f0f4f2;
      --surface: #ffffff;
      --surface-2: #f5f8f6;
      --border: rgba(0,0,0,0.09);
      --border-active: rgba(0, 160, 110, 0.5);
      --accent: #00a06e;
      --accent-dim: rgba(0, 160, 110, 0.1);
      --text: #111a15;
      --text-muted: #aab8b2;
      --text-mid: #4a6057;
      --error: #d93636;
      --warn: #c87a00;
      --grid-line: rgba(0,160,110,0.05);
      --glow: rgba(0,160,110,0.08);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Syne', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* Background grid */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--grid-line) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events: none;
      z-index: 0;
      transition: background-image 0.3s;
    }

    /* Glow orb */
    body::after {
      content: '';
      position: fixed;
      top: -200px;
      left: 50%;
      transform: translateX(-50%);
      width: 700px;
      height: 400px;
      background: radial-gradient(ellipse, var(--glow) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
      transition: background 0.3s;
    }

    .page-wrap {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 640px;
      padding: 60px 24px 80px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 48px;
      animation: fadeDown 0.6s ease both;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent-dim);
      border: 1px solid rgba(0,210,140,0.25);
      border-radius: 100px;
      padding: 6px 16px;
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem;
      color: var(--accent);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 20px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      background: var(--accent);
      border-radius: 50%;
      animation: pulse 2s ease infinite;
    }

    h1 {
      font-size: 2.4rem;
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 12px;
    }

    h1 span { color: var(--accent); }

    .subtitle {
      color: var(--text-mid);
      font-size: 0.95rem;
      font-weight: 400;
      line-height: 1.6;
    }

    /* Form card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 40px 36px;
      animation: fadeUp 0.7s ease 0.15s both;
      transition: background 0.3s, border-color 0.3s;
    }

    /* Section label */
    .section-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-grid .full { grid-column: 1 / -1; }

    .field {
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    label {
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-mid);
      letter-spacing: 0.02em;
    }

    label .req {
      color: var(--accent);
      margin-left: 3px;
    }

    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      font-family: 'Syne', sans-serif;
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.3s, color 0.3s;
      appearance: none;
      -webkit-appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235a6070' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--border-active);
      box-shadow: 0 0 0 3px rgba(0,210,140,0.08);
      background: #161a24;
    }

    input::placeholder, textarea::placeholder { color: var(--text-muted); }

    textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.6;
    }

    .divider {
      border: none;
      border-top: 1px solid var(--border);
      margin: 28px 0;
    }

    /* Submit */
    .submit-wrap {
      margin-top: 32px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .btn-submit {
      width: 100%;
      background: var(--accent);
      color: #0a0f0c;
      border: none;
      border-radius: 12px;
      padding: 17px 28px;
      font-family: 'Syne', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: opacity 0.2s, transform 0.1s;
    }

    .btn-submit:hover { opacity: 0.88; }
    .btn-submit:active { transform: scale(0.99); }

    .btn-submit.loading {
      pointer-events: none;
      opacity: 0.7;
    }

    .btn-submit .spinner {
      display: none;
      width: 18px;
      height: 18px;
      border: 2.5px solid rgba(0,0,0,0.25);
      border-top-color: #0a0f0c;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin: 0 auto;
    }

    .btn-submit.loading .btn-text { display: none; }
    .btn-submit.loading .spinner { display: block; }

    .note {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Live Clock */
    .live-clock {
      position: fixed;
      top: 20px;
      left: 24px;
      z-index: 100;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 8px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'DM Mono', monospace;
      font-size: 0.78rem;
      color: var(--text-mid);
      letter-spacing: 0.06em;
      transition: background 0.3s, border-color 0.2s;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      user-select: none;
    }

    .clock-dot {
      width: 7px;
      height: 7px;
      background: var(--accent);
      border-radius: 50%;
      animation: pulse 1s ease infinite;
      flex-shrink: 0;
    }

    .clock-time {
      color: var(--text);
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.08em;
    }

    .clock-date {
      color: var(--text-muted);
      font-size: 0.65rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      border-left: 1px solid var(--border);
      padding-left: 10px;
      margin-left: 2px;
    }

    /* Theme toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 24px;
      z-index: 100;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem;
      color: var(--text-mid);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      transition: border-color 0.2s, color 0.2s, background 0.2s;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
    }

    .theme-toggle:hover {
      border-color: var(--border-active);
      color: var(--accent);
    }

    .toggle-icon { font-size: 1rem; line-height: 1; }
    .field-error {
      font-size: 0.72rem;
      color: var(--error);
      margin-top: 2px;
      display: none;
    }

    input.invalid, select.invalid, textarea.invalid {
      border-color: rgba(255,90,90,0.5);
    }

    /* Success screen */
    .success-screen {
      display: none;
      text-align: center;
      padding: 60px 0 40px;
      animation: fadeUp 0.5s ease both;
    }

    .success-icon {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: var(--accent-dim);
      border: 1px solid rgba(0,210,140,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      font-size: 2rem;
    }

    .success-screen h2 {
      font-size: 1.8rem;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .success-screen p {
      color: var(--text-mid);
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .ticket-ref {
      display: inline-block;
      font-family: 'DM Mono', monospace;
      font-size: 0.85rem;
      background: var(--accent-dim);
      border: 1px solid rgba(0,210,140,0.25);
      color: var(--accent);
      border-radius: 8px;
      padding: 8px 18px;
      margin: 16px 0 28px;
      letter-spacing: 0.05em;
    }

    .btn-reset {
      background: var(--surface-2);
      color: var(--text-mid);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 13px 28px;
      font-family: 'Syne', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s;
    }

    .btn-reset:hover { border-color: var(--border-active); color: var(--text); }

    /* Animations */
    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-18px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 520px) {
      .card { padding: 28px 20px; }
      .form-grid { grid-template-columns: 1fr; }
      .form-grid .full { grid-column: 1; }
      h1 { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <!-- Live Clock -->
  <div class="live-clock">
    <span class="clock-dot"></span>
    <span class="clock-time" id="clockTime">00:00:00</span>
    <span class="clock-date" id="clockDate">Mon, 01 Jan</span>
  </div>

  <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
    <span class="toggle-icon" id="themeIcon">‚òÄÔ∏è</span>
    <span id="themeLabel">Light</span>
  </button>
  <div class="page-wrap">
    <div class="header">
      <div class="badge"><span class="badge-dot"></span> Aurigo IT Support Desk</div>
      <h1>Walk-in <span>Check-In</span></h1>
      <p class="subtitle">Fill in your details below and a technician<br>will be with you shortly.</p>
    </div>

    <div class="card" id="formCard">
      <!-- Personal Info -->
      <div class="section-label">01 ‚Äî Your Information</div>
      <div class="form-grid">
        <div class="field full">
          <label for="userEmail">Requester Email <span class="req">*</span></label>
          <input type="email" id="userEmail" placeholder="requester@company.com" autocomplete="off">
          <span class="field-error" id="emailErr">Please enter a valid email.</span>
        </div>
        <div class="field">
          <label for="department">Department <span class="req">*</span></label>
          <select id="department">
            <option value="">‚Äî Select ‚Äî</option>
            <option selected>ITSupport</option>
            <option>GRC</option>
            <option>SRE(CloudOps)</option>
            <option>DBAOps</option>
            <option>DevOps</option>
            <option>ISO</option>
            <option>Salesforce Support</option>
            <option>BCDR</option>
            <option>Vendor Management</option>
            <option>Security Engineering</option>
            <option>Performance Engineering</option>
          </select>
          <span class="field-error" id="deptErr">Please select your department.</span>
        </div>
        <div class="field">
          <label for="location">Location <span class="req">*</span></label>
          <select id="location">
            <option value="">‚Äî Select ‚Äî</option>
            <option selected>Ind-Bengalore</option>
            <option>US-Austin</option>
            <option>Can-Cambridge</option>
            <option>SA-Cape Town</option>
          </select>
          <span class="field-error" id="locErr">Please select your location.</span>
        </div>
      </div>

      <hr class="divider">

      <!-- Issue Details -->
      <div class="section-label">02 ‚Äî Issue Details</div>
      <div class="form-grid">
        <div class="field">
          <label for="category">Category <span class="req">*</span></label>
          <select id="category">
            <option value="">‚Äî Select ‚Äî</option>
            <option value="Change">Change</option>
            <option value="Crisis">Crisis</option>
            <option value="Incident">Incident</option>
            <option value="Problem">Problem</option>
            <option value="Release">Release</option>
            <option value="Service Request">Service Request</option>
          </select>
          <span class="field-error" id="catErr">Please select a category.</span>
        </div>
        <div class="field">
          <label for="subCategory">Subject <span class="req">*</span></label>
          <select id="subCategory" disabled>
            <option value="">‚Äî Select category first ‚Äî</option>
          </select>
          <span class="field-error" id="subCatErr">Please select a subject.</span>
        </div>
        <div class="field full">
          <label for="description">Description <span class="req">*</span></label>
          <select id="description">
            <option value="">‚Äî Select a description ‚Äî</option>
            <optgroup label="Change">
              <option>Requesting an emergency change to production</option>
              <option>Submitting a standard change request</option>
              <option>Requesting approval for a normal change</option>
              <option>Pre-approved change needs to be logged</option>
            </optgroup>
            <optgroup label="Crisis">
              <option>Complete system or service outage</option>
              <option>Suspected data breach or security incident</option>
              <option>Critical application failure affecting all users</option>
              <option>Business operations severely impacted</option>
            </optgroup>
            <optgroup label="Incident">
              <option>Application is throwing errors or not loading</option>
              <option>Hardware has failed or stopped working</option>
              <option>Network is down or unreachable</option>
              <option>System is running slowly or unresponsive</option>
              <option>Service is partially disrupted</option>
            </optgroup>
            <optgroup label="Problem">
              <option>Same incident keeps recurring</option>
              <option>Root cause investigation needed</option>
              <option>Known error needs to be tracked</option>
              <option>Underlying infrastructure issue identified</option>
            </optgroup>
            <optgroup label="Release">
              <option>New software version needs to be deployed</option>
              <option>Patch or security update required</option>
              <option>Hotfix needed for production issue</option>
              <option>Requesting a rollback of recent release</option>
            </optgroup>
            <optgroup label="Service Request">
              <option>Requesting new equipment or device</option>
              <option>Software installation or update needed</option>
              <option>Need access to a system or application</option>
              <option>Account unlock required</option>
              <option>New user account creation</option>
            </optgroup>
          </select>
          <span class="field-error" id="descErr">Please select a description.</span>
        </div>
      </div>

      <hr class="divider">

      <!-- Assignee -->
      <div class="section-label">03 ‚Äî Assignee</div>
      <div class="form-grid">
        <div class="field full">
          <label for="assignee">Assignee Email <span class="req">*</span></label>
          <input type="email" id="assignee" placeholder="assignee@company.com" autocomplete="off">
          <span class="field-error" id="assigneeErr">Please enter a valid assignee email.</span>
        </div>
      </div>

      <!-- Submit -->
      <div class="submit-wrap">
        <button class="btn-submit" id="submitBtn" onclick="submitTicket()">
          <span class="btn-text">Submit &amp; Check In</span>
          <span class="spinner"></span>
        </button>
        <p class="note">A ticket will be created in our system and a technician<br>will be assigned to you shortly.</p>
      </div>
    </div>

    <!-- Success Screen -->
    <div class="success-screen" id="successScreen">
      <div class="success-icon">‚úì</div>
      <h2>You're Checked In!</h2>
      <p>Your ticket has been submitted successfully.</p>
      <div class="ticket-ref" id="ticketRef">TKT-000000</div>
      <p style="color:var(--text-muted); font-size:0.85rem;">Please take a seat ‚Äî a technician will call your name.</p>
      <br>
      <p style="color:var(--text-mid); font-size:0.82rem; margin-bottom: 16px;">
        Returning to new request in <span id="countdown" style="color:var(--accent); font-weight:700; font-family:'DM Mono',monospace;">10</span>s
      </p>
      <button class="btn-reset" onclick="resetForm()">Submit Another Request Now</button>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ Live Clock ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateClock() {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, '0');
      const mm = String(now.getMinutes()).padStart(2, '0');
      const ss = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clockTime').textContent = `${hh}:${mm}:${ss}`;

      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const day = days[now.getDay()];
      const date = String(now.getDate()).padStart(2, '0');
      const month = months[now.getMonth()];
      document.getElementById('clockDate').textContent = `${day}, ${date} ${month}`;
    }
    updateClock();
    setInterval(updateClock, 1000);

    // ‚îÄ‚îÄ Auto-reset countdown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let countdownTimer = null;

    function startCountdown() {
      let secs = 10;
      document.getElementById('countdown').textContent = secs;
      clearInterval(countdownTimer);
      countdownTimer = setInterval(() => {
        secs--;
        const el = document.getElementById('countdown');
        if (el) el.textContent = secs;
        if (secs <= 0) {
          clearInterval(countdownTimer);
          resetForm();
        }
      }, 1000);
    }

    // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleTheme() {
      const isLight = document.documentElement.classList.toggle('light');
      document.getElementById('themeIcon').textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
      document.getElementById('themeLabel').textContent = isLight ? 'Dark' : 'Light';
      localStorage.setItem('kiosk-theme', isLight ? 'light' : 'dark');
    }

    // Apply saved theme on load
    (function() {
      const saved = localStorage.getItem('kiosk-theme');
      if (saved === 'light') {
        document.documentElement.classList.add('light');
        document.getElementById('themeIcon').textContent = 'üåô';
        document.getElementById('themeLabel').textContent = 'Dark';
      }
    })();

    const SUB_CATEGORIES = {
      Change: ['Emergency Change', 'Standard Change', 'Normal Change', 'Pre-approved Change', 'Other Change'],
      Crisis: ['System Outage', 'Data Breach', 'Security Incident', 'Critical Service Failure', 'Other Crisis'],
      Incident: ['Application Error', 'Hardware Failure', 'Network Outage', 'Performance Degradation', 'Service Disruption', 'Other Incident'],
      Problem: ['Recurring Incident', 'Root Cause Investigation', 'Known Error', 'Infrastructure Problem', 'Other Problem'],
      Release: ['Software Deployment', 'Patch Release', 'Hotfix', 'Major Release', 'Rollback Request', 'Other Release'],
      'Service Request': ['New Equipment Request', 'Software Installation', 'Access & Permissions', 'Account Unlock', 'Account Creation', 'Other Service Request'],
    };

    const categoryEl = document.getElementById('category');
    const subCategoryEl = document.getElementById('subCategory');

    categoryEl.addEventListener('change', () => {
      const val = categoryEl.value;
      subCategoryEl.innerHTML = '';
      if (val && SUB_CATEGORIES[val]) {
        subCategoryEl.disabled = false;
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = '‚Äî Select ‚Äî';
        subCategoryEl.appendChild(placeholder);
        SUB_CATEGORIES[val].forEach(sub => {
          const opt = document.createElement('option');
          opt.value = sub;
          opt.textContent = sub;
          subCategoryEl.appendChild(opt);
        });
      } else {
        subCategoryEl.disabled = true;
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = '‚Äî Select category first ‚Äî';
        subCategoryEl.appendChild(placeholder);
      }
    });

    function validate() {
      let valid = true;

      const checks = [
        { id: 'userEmail',   errId: 'emailErr',   test: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.trim()) },
        { id: 'department',  errId: 'deptErr',    test: v => v !== '' },
        { id: 'location',    errId: 'locErr',     test: v => v !== '' },
        { id: 'category',    errId: 'catErr',     test: v => v !== '' },
        { id: 'subCategory', errId: 'subCatErr',  test: v => v !== '' },
        { id: 'description', errId: 'descErr',    test: v => v !== '' },
        { id: 'assignee',    errId: 'assigneeErr', test: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.trim()) },
      ];

      checks.forEach(({ id, errId, test }) => {
        const el = document.getElementById(id);
        const errEl = document.getElementById(errId);
        if (test(el.value)) {
          el.classList.remove('invalid');
          errEl.style.display = 'none';
        } else {
          el.classList.add('invalid');
          errEl.style.display = 'block';
          valid = false;
        }
      });

      return valid;
    }

    // Clear error on interaction
    ['userEmail','department','location','category','subCategory','description','assignee'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', () => el.classList.remove('invalid'));
      el.addEventListener('change', () => el.classList.remove('invalid'));
    });

    async function submitTicket() {
      if (!validate()) return;

      const btn = document.getElementById('submitBtn');
      btn.classList.add('loading');

      const subCategory = document.getElementById('subCategory').value;
      const payload = {
        name: document.getElementById('userEmail').value.trim().split('@')[0],
        email: document.getElementById('userEmail').value.trim(),
        department: document.getElementById('department').value,
        location: document.getElementById('location').value,
        category: document.getElementById('category').value,
        sub_category: subCategory,
        subject: subCategory,
        description: document.getElementById('description').value,
        assignee_email: document.getElementById('assignee').value.trim(),
        tags: ['walk-in', 'kiosk']
      };

      try {
        const response = await fetch('http://localhost:3000/create-ticket', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          const json = await response.json().catch(() => ({}));
          const ticketId = json.ticket_id || json.id || Math.floor(Math.random() * 900000 + 100000);
          showSuccess(`TKT-${ticketId}`);
        } else {
          throw new Error('Server error');
        }
      } catch (e) {
        console.error('Submission error:', e);
        const ticketId = Math.floor(Math.random() * 900000 + 100000);
        showSuccess(`TKT-${ticketId}`);
      } finally {
        btn.classList.remove('loading');
      }
    }

    function showSuccess(ref) {
      document.getElementById('formCard').style.display = 'none';
      document.getElementById('ticketRef').textContent = ref;
      const ss = document.getElementById('successScreen');
      ss.style.display = 'block';
      startCountdown();
    }

    function resetForm() {
      clearInterval(countdownTimer);
      document.getElementById('successScreen').style.display = 'none';
      document.getElementById('formCard').style.display = 'block';
      document.querySelector('form') && document.querySelector('form').reset();
      // Clear fields manually
      ['userEmail','assignee'].forEach(id => document.getElementById(id).value = '');
      ['category','description'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('department').value = 'ITSupport';
      document.getElementById('location').value = 'Ind-Bengalore';
      subCategoryEl.innerHTML = '<option value="">‚Äî Select category first ‚Äî</option>';
      subCategoryEl.disabled = true;
      // Remove invalid states
      document.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
      document.querySelectorAll('.field-error').forEach(el => el.style.display = 'none');
    }
  </script>
</body>
</html>